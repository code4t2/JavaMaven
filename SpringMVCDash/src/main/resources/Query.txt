SELECT
X.FY
,X.TRANSACTIONTYPE
,COUNT(X.PRODUCTID) AS PRODUCTCOUNT
FROM
(SELECT
	YEAR(TH.TRANSACTIONDATE) AS FY
	,MONTH(TH.TRANSACTIONDATE) AS FM
	,TH.TRANSACTIONDATE
	,TH.PRODUCTID
	,P.NAME
	,TH.TRANSACTIONTYPE
	,TH.ACTUALCOST
	FROM [PRODUCTION].[TRANSACTIONHISTORY] TH
	JOIN [PRODUCTION].[PRODUCT] P
	ON (TH.PRODUCTID = P.PRODUCTID)
	WHERE 1=1
) X
WHERE 1=1
--AND X.FY= 2007
--AND X.TRANSACTIONTYPE = 'P'
GROUP BY
X.FY
,X.TRANSACTIONTYPE;

SELECT X.FY, X.TRANSACTIONTYPE, COUNT(X.PRODUCTID) AS PRODUCTCOUNT FROM (SELECT	YEAR(TH.TRANSACTIONDATE) AS FY, MONTH(TH.TRANSACTIONDATE) AS FM, TH.TRANSACTIONDATE, TH.PRODUCTID, P.NAME, TH.TRANSACTIONTYPE, TH.ACTUALCOST FROM [PRODUCTION].[TRANSACTIONHISTORY] TH JOIN [PRODUCTION].[PRODUCT] P ON (TH.PRODUCTID = P.PRODUCTID) WHERE 1=1) X WHERE 1=1 GROUP BY X.FY, X.TRANSACTIONTYPE;

